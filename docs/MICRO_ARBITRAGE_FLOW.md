# üí± Micro Arbitrage Flow ÏãúÌÄÄÏä§ Îã§Ïù¥Ïñ¥Í∑∏Îû®

> **DeFi ÎßàÏù¥ÌÅ¨Î°úÏïÑÎπÑÌä∏Î¶¨ÏßÄ Ï†ÑÎûµÏùò Î™®Îì† ÏãúÎÇòÎ¶¨Ïò§Î≥Ñ ÏÉÅÏÑ∏ ÏãúÌÄÄÏä§ Îã§Ïù¥Ïñ¥Í∑∏Îû®**
>
> Í∞Å Ïª¥Ìè¨ÎÑåÌä∏ÏôÄ Ïô∏Î∂Ä ÏÑúÎπÑÏä§ Í∞ÑÏùò ÏÉÅÌò∏ÏûëÏö©ÏùÑ Îã®Í≥ÑÎ≥ÑÎ°ú ÏãúÍ∞ÅÌôî

---

## üìã Î™©Ï∞®

1. [Ï†ÑÏ≤¥ ÏïÑÎπÑÌä∏Î¶¨ÏßÄ ÌîÑÎ°úÏÑ∏Ïä§](#-Ï†ÑÏ≤¥-ÏïÑÎπÑÌä∏Î¶¨ÏßÄ-ÌîÑÎ°úÏÑ∏Ïä§)
2. [CEX/DEX Í∞ÄÍ≤© ÎπÑÍµê ÏÉÅÏÑ∏ ÌîåÎ°úÏö∞](#-cexdex-Í∞ÄÍ≤©-ÎπÑÍµê-ÏÉÅÏÑ∏-ÌîåÎ°úÏö∞)
3. [Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤© Î™®ÎãàÌÑ∞ÎßÅ ÌîåÎ°úÏö∞](#-Ïã§ÏãúÍ∞Ñ-Í∞ÄÍ≤©-Î™®ÎãàÌÑ∞ÎßÅ-ÌîåÎ°úÏö∞)
4. [ÏïÑÎπÑÌä∏Î¶¨ÏßÄ Í∏∞Ìöå ÌÉêÏßÄ ÌîåÎ°úÏö∞](#-ÏïÑÎπÑÌä∏Î¶¨ÏßÄ-Í∏∞Ìöå-ÌÉêÏßÄ-ÌîåÎ°úÏö∞)
5. [MEV Î≤àÎì§ ÏÉùÏÑ± Î∞è Ï†úÏ∂ú ÌîåÎ°úÏö∞](#-mev-Î≤àÎì§-ÏÉùÏÑ±-Î∞è-Ï†úÏ∂ú-ÌîåÎ°úÏö∞)
6. [Flashloan ÏïÑÎπÑÌä∏Î¶¨ÏßÄ Ïã§Ìñâ ÌîåÎ°úÏö∞](#-flashloan-ÏïÑÎπÑÌä∏Î¶¨ÏßÄ-Ïã§Ìñâ-ÌîåÎ°úÏö∞)
7. [Wallet Î™®Îìú ÏïÑÎπÑÌä∏Î¶¨ÏßÄ Ïã§Ìñâ ÌîåÎ°úÏö∞](#-wallet-Î™®Îìú-ÏïÑÎπÑÌä∏Î¶¨ÏßÄ-Ïã§Ìñâ-ÌîåÎ°úÏö∞)
8. [Í≤ΩÏüÅ Î∂ÑÏÑù Î∞è Í∞ÄÏä§ ÏµúÏ†ÅÌôî ÌîåÎ°úÏö∞](#-Í≤ΩÏüÅ-Î∂ÑÏÑù-Î∞è-Í∞ÄÏä§-ÏµúÏ†ÅÌôî-ÌîåÎ°úÏö∞)
9. [ÏóêÎü¨ Ï≤òÎ¶¨ Î∞è Î≥µÍµ¨ ÌîåÎ°úÏö∞](#-ÏóêÎü¨-Ï≤òÎ¶¨-Î∞è-Î≥µÍµ¨-ÌîåÎ°úÏö∞)
10. [ÏÑ±Îä• Î™®ÎãàÌÑ∞ÎßÅ ÌîåÎ°úÏö∞](#-ÏÑ±Îä•-Î™®ÎãàÌÑ∞ÎßÅ-ÌîåÎ°úÏö∞)

---

## üîÑ Ï†ÑÏ≤¥ ÏïÑÎπÑÌä∏Î¶¨ÏßÄ ÌîÑÎ°úÏÑ∏Ïä§

### 1Ô∏è‚É£ ÌÜµÌï© ÏïÑÎπÑÌä∏Î¶¨ÏßÄ Í¥ÄÎ¶¨Ïûê Ïã§Ìñâ ÌîåÎ°úÏö∞

```mermaid
sequenceDiagram
    participant User as ÏÇ¨Ïö©Ïûê/Î¥á
    participant MAM as MicroArbitrageManager
    participant PM as PriceMonitor
    participant OD as OpportunityDetector
    participant EE as ExecutionEngine
    participant RM as RiskManager
    participant PT as PerformanceTracker

    User->>MAM: start_automated_arbitrage()
    activate MAM

    MAM->>PM: start_monitoring()
    activate PM
    PM-->>MAM: OK
    deactivate PM

    loop Î©îÏù∏ Ïã§Ìñâ Î£®ÌîÑ (1Ï¥àÎßàÎã§)
        MAM->>MAM: detect_and_analyze_opportunities()

        MAM->>PM: get_latest_prices()
        activate PM
        PM-->>MAM: price_data_map
        deactivate PM

        MAM->>OD: detect_opportunities(price_data)
        activate OD

        loop Í∞Å Í∞ÄÍ≤© Ïåç
            OD->>OD: analyze_price_difference()
            OD->>OD: calculate_profitability()
            OD->>OD: calculate_confidence_score()
        end

        OD-->>MAM: opportunities[]
        deactivate OD

        alt Í∏∞Ìöå Î∞úÍ≤¨
            MAM->>RM: assess_opportunity_risk(opportunity)
            activate RM
            RM-->>MAM: risk_assessment
            deactivate RM

            alt ÏúÑÌóò ÌóàÏö© Í∞ÄÎä•
                MAM->>EE: execute_arbitrage(opportunity)
                activate EE

                EE->>EE: select_funding_mode()
                EE->>EE: validate_opportunity()

                alt Wallet Î™®Îìú
                    EE->>EE: execute_with_wallet()
                else Flashloan Î™®Îìú
                    EE->>EE: execute_with_flashloan()
                end

                EE-->>MAM: execution_result
                deactivate EE

                MAM->>PT: record_execution(result)
                activate PT
                PT-->>MAM: OK
                deactivate PT
            end
        end

        MAM->>MAM: update_performance_metrics()
        MAM->>MAM: cleanup_expired_data()
    end

    User->>MAM: stop_automated_arbitrage()
    MAM->>PM: stop_monitoring()
    MAM-->>User: final_stats
    deactivate MAM
```

---

## üí± CEX/DEX Í∞ÄÍ≤© ÎπÑÍµê ÏÉÅÏÑ∏ ÌîåÎ°úÏö∞

### 2Ô∏è‚É£ Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤© ÏàòÏßë Î∞è ÎπÑÍµê

```mermaid
sequenceDiagram
    participant PM as PriceMonitor
    participant Binance as Binance WebSocket
    participant Coinbase as Coinbase WebSocket
    participant Uniswap as Uniswap V2 RPC
    participant Sushi as SushiSwap RPC
    participant OD as OpportunityDetector

    PM->>Binance: WebSocket Ïó∞Í≤∞
    activate Binance
    Binance-->>PM: price_updates
    deactivate Binance

    PM->>Coinbase: WebSocket Ïó∞Í≤∞
    activate Coinbase
    Coinbase-->>PM: price_updates
    deactivate Coinbase

    PM->>Uniswap: RPC Ìò∏Ï∂ú
    activate Uniswap
    Uniswap-->>PM: pool_reserves
    deactivate Uniswap

    PM->>Sushi: RPC Ìò∏Ï∂ú
    activate Sushi
    Sushi-->>PM: pool_reserves
    deactivate Sushi

    PM->>OD: get_latest_prices()
    activate OD

    loop Í∞Å Ïã¨Î≥º (ETH, BTC, USDC Îì±)
        OD->>OD: compare_cex_dex_prices()
        
        alt Í∞ÄÍ≤© Ï∞®Ïù¥ > ÏûÑÍ≥ÑÍ∞í
            OD->>OD: calculate_arbitrage_profit()
            OD->>OD: estimate_gas_costs()
            OD->>OD: calculate_net_profit()
            
            alt ÏàúÏàòÏùµ > ÏµúÏÜå ÏûÑÍ≥ÑÍ∞í
                OD->>OD: create_arbitrage_opportunity()
            end
        end
    end

    OD-->>PM: opportunities[]
    deactivate OD
```

### 3Ô∏è‚É£ Binance Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤© ÏàòÏßë

```mermaid
sequenceDiagram
    participant PM as PriceMonitor
    participant Binance as Binance WebSocket
    participant Cache as PriceCache

    PM->>Binance: WebSocket Ïó∞Í≤∞ ÏöîÏ≤≠
    activate Binance
    Binance-->>PM: Ïó∞Í≤∞ ÏÑ±Í≥µ
    deactivate Binance

    loop Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
        Binance->>PM: price_update_stream
        activate PM

        PM->>PM: parse_price_data()
        PM->>PM: validate_price_data()

        alt Í∞ÄÍ≤© Îç∞Ïù¥ÌÑ∞ Ïú†Ìö®
            PM->>Cache: update_price(symbol, price_data)
            activate Cache
            Cache-->>PM: OK
            deactivate Cache

            PM->>PM: notify_price_change()
        else Í∞ÄÍ≤© Îç∞Ïù¥ÌÑ∞ Î¨¥Ìö®
            PM->>PM: log_invalid_data()
        end

        deactivate PM
    end

    Note over PM,Binance: Ïó∞Í≤∞ ÎÅäÍπÄ Í∞êÏßÄ Ïãú ÏûêÎèô Ïû¨Ïó∞Í≤∞
    PM->>Binance: Ïû¨Ïó∞Í≤∞ ÏöîÏ≤≠
    activate Binance
    Binance-->>PM: Ïû¨Ïó∞Í≤∞ ÏÑ±Í≥µ
    deactivate Binance
```

### 4Ô∏è‚É£ Uniswap V2 Í∞ÄÍ≤© Í≥ÑÏÇ∞

```mermaid
sequenceDiagram
    participant PM as PriceMonitor
    participant Uniswap as Uniswap V2 Contract
    participant Cache as PriceCache

    PM->>Uniswap: getReserves() Ìò∏Ï∂ú
    activate Uniswap
    Uniswap-->>PM: (reserve0, reserve1, blockTimestampLast)
    deactivate Uniswap

    PM->>PM: calculate_price_from_reserves()
    Note right of PM: price = reserve1 / reserve0<br/>(ÌÜ†ÌÅ∞1 Í∏∞Ï§Ä ÌÜ†ÌÅ∞0 Í∞ÄÍ≤©)

    PM->>PM: apply_twap_filter()
    Note right of PM: 5Î∂Ñ TWAP Ï†ÅÏö©<br/>Í∞ÄÍ≤© Ï°∞Ïûë Î∞©ÏßÄ

    PM->>Cache: update_dex_price(symbol, calculated_price)
    activate Cache
    Cache-->>PM: OK
    deactivate Cache

    PM->>PM: check_price_deviation()
    Note right of PM: Chainlink Ïò§ÎùºÌÅ¥Í≥º<br/>¬±5% Ìé∏Ï∞® Ï≤¥ÌÅ¨

    alt Ìé∏Ï∞® Ï†ïÏÉÅ
        PM->>PM: price_validated = true
    else Ìé∏Ï∞® Ï¥àÍ≥º
        PM->>PM: price_validated = false
        PM->>PM: log_price_deviation_warning()
    end
```

---

## üîç ÏïÑÎπÑÌä∏Î¶¨ÏßÄ Í∏∞Ìöå ÌÉêÏßÄ ÌîåÎ°úÏö∞

### 5Ô∏è‚É£ Í∞ÄÍ≤© Ï∞®Ïù¥ Î∂ÑÏÑù Î∞è Í∏∞Ìöå ÏÉùÏÑ±

```mermaid
sequenceDiagram
    participant OD as OpportunityDetector
    participant PC as ProfitabilityCalculator
    participant CA as CompetitionAnalyzer
    participant Cache as PriceCache

    OD->>Cache: get_all_prices()
    activate Cache
    Cache-->>OD: price_data_map
    deactivate Cache

    loop CEX-DEX Í∞ÄÍ≤© Ïåç ÎπÑÍµê
        OD->>OD: compare_cex_dex_prices(cex_price, dex_price)
        
        alt cex_price < dex_price
            OD->>OD: calculate_price_spread()
            Note right of OD: spread = (dex_price - cex_price) / cex_price

            alt spread > min_threshold (0.1%)
                OD->>PC: calculate_profitability()
                activate PC

                PC->>PC: estimate_trade_amount()
                PC->>PC: calculate_gas_costs()
                PC->>PC: calculate_net_profit()

                PC-->>OD: profitability_analysis
                deactivate PC

                alt net_profit > min_profit_usd
                    OD->>CA: analyze_competition()
                    activate CA
                    CA-->>OD: competition_level
                    deactivate CA

                    OD->>OD: calculate_confidence_score()
                    Note right of OD: confidence = f(spread, competition, volatility)

                    OD->>OD: create_arbitrage_opportunity()
                    Note right of OD: MicroArbitrageOpportunity ÏÉùÏÑ±
                end
            end
        end
    end

    OD->>OD: sort_opportunities_by_profit()
    OD-->>OD: return_top_opportunities()
```

### 6Ô∏è‚É£ ÏàòÏùµÏÑ± Í≥ÑÏÇ∞ ÏÉÅÏÑ∏ ÌîåÎ°úÏö∞

```mermaid
sequenceDiagram
    participant PC as ProfitabilityCalculator
    participant GE as GasEstimator
    participant PO as PriceOracle
    participant DA as DexAggregator

    PC->>PC: calculate_gross_profit()
    Note right of PC: gross_profit = trade_amount √ó price_spread

    PC->>GE: estimate_gas_costs()
    activate GE
    GE->>GE: get_current_gas_price()
    GE->>GE: estimate_transaction_gas()
    GE-->>PC: gas_cost_usd
    deactivate GE

    PC->>DA: get_swap_quote()
    activate DA
    DA->>DA: find_best_route()
    DA-->>PC: swap_quote{price_impact, fees}
    deactivate DA

    PC->>PC: calculate_slippage_cost()
    Note right of PC: slippage = trade_amount √ó price_impact

    PC->>PC: calculate_exchange_fees()
    Note right of PC: cex_fee + dex_fee

    PC->>PC: calculate_net_profit()
    Note right of PC: net_profit = gross_profit - gas_cost - slippage - fees

    PC->>PC: calculate_roi()
    Note right of PC: roi = net_profit / trade_amount √ó 100%

    PC-->>PC: return_profitability_analysis()
```

---

## ‚ö° MEV Î≤àÎì§ ÏÉùÏÑ± Î∞è Ï†úÏ∂ú ÌîåÎ°úÏö∞

### 7Ô∏è‚É£ ÏïÑÎπÑÌä∏Î¶¨ÏßÄ Î≤àÎì§ ÏÉùÏÑ±

```mermaid
sequenceDiagram
    participant EE as ExecutionEngine
    participant BB as BundleBuilder
    participant ABICodec as ABICodec
    participant DA as DexAggregator
    participant FB as FlashbotsClient
    participant Relay as Flashbots Relay

    EE->>BB: build_arbitrage_bundle(opportunity)
    activate BB

    BB->>BB: analyze_competition_level()
    Note right of BB: Í≤ΩÏüÅ ÏàòÏ§Ä Î∂ÑÏÑù<br/>Í∞ÄÏä§ Í∞ÄÍ≤© Î∂ÑÌè¨ ÌôïÏù∏

    BB->>BB: calculate_success_probability()
    Note right of BB: success_prob = f(competition, gas_price, timing)

    Note over BB,DA: Flashloan ÌôúÏÑ±Ìôî Ïãú
    BB->>DA: get_swap_quote(cex_token‚Üídex_token)
    activate DA
    DA-->>BB: SwapQuote{to, data, allowanceTarget}
    deactivate DA

    BB->>ABICodec: encode_arbitrage_params()
    activate ABICodec
    ABICodec-->>BB: encoded_params
    deactivate ABICodec

    BB->>ABICodec: encode_aave_flashloan_simple()
    activate ABICodec
    ABICodec-->>BB: flashloan_calldata
    deactivate ABICodec

    BB->>BB: create_arbitrage_bundle(flashloan_tx)
    Note right of BB: Bundle{tx[], max_fee, max_priority_fee}

    BB-->>EE: ArbitrageBundle
    deactivate BB

    EE->>EE: execute_arbitrage_bundle(bundle)
    activate EE

    EE->>EE: simulate_bundle()
    Note right of EE: ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏÑ±Í≥µ ÌôïÏù∏

    EE->>FB: submit_bundle(bundle)
    activate FB

    FB->>Relay: POST /relay/v1/builders
    activate Relay
    Relay-->>FB: bundle_hash
    deactivate Relay

    FB-->>EE: bundle_hash
    deactivate FB

    loop ÏµúÎåÄ 20Î∏îÎ°ù ÎåÄÍ∏∞ (4Î∂Ñ)
        EE->>Relay: GET /relay/v1/bundle_status
        activate Relay
        Relay-->>EE: status (pending/included/rejected)
        deactivate Relay

        alt status == included
            EE->>EE: update_execution_stats(success)
            EE-->>EE: ArbitrageExecutionResult{success=true, profit_realized}
        else status == rejected
            EE-->>EE: ArbitrageExecutionResult{success=false, error}
        end
    end

    deactivate EE
```

---

## üí∞ Flashloan ÏïÑÎπÑÌä∏Î¶¨ÏßÄ Ïã§Ìñâ ÌîåÎ°úÏö∞

### 8Ô∏è‚É£ Aave Flash Loan ÏïÑÎπÑÌä∏Î¶¨ÏßÄ ÏÉÅÏÑ∏ Í≥ºÏ†ï

```mermaid
sequenceDiagram
    participant EE as ExecutionEngine
    participant AavePool as Aave Pool
    participant Contract as ArbitrageContract
    participant CEX as CEX API
    participant DEX as DEX Router
    participant Owner as Bot Owner

    EE->>AavePool: flashLoanSimple(contract, asset, amount, params, 0)
    activate AavePool

    AavePool->>Contract: executeOperation(asset, amount, premium, initiator, params)
    activate Contract

    Note over Contract: 1. CEX Îß§Ïàò (ÏãúÎÆ¨Î†àÏù¥ÏÖò)
    Contract->>CEX: place_buy_order()
    activate CEX
    CEX-->>Contract: order_confirmed
    deactivate CEX

    Note over Contract: 2. DEX Îß§ÎèÑ
    Contract->>DEX: swap(tokens, min_amount_out)
    activate DEX
    DEX-->>Contract: swap_completed
    deactivate DEX

    Note over Contract: 3. Flashloan ÏÉÅÌôò
    Contract->>AavePool: repay(amount + premium)
    AavePool-->>Contract: repayment_successful

    Note over Contract: 4. ÏàòÏùµ Ï†ÑÏÜ°
    Contract->>Owner: transfer(profit)
    activate Owner
    Owner-->>Contract: profit_received
    deactivate Owner

    Contract-->>AavePool: executeOperation completed
    deactivate Contract

    AavePool-->>EE: flashloan completed
    deactivate AavePool

    EE->>EE: update_execution_stats()
```

### 9Ô∏è‚É£ Ïã§Ï†ú CEX Ï£ºÎ¨∏ Ïã§Ìñâ (Binance)

```mermaid
sequenceDiagram
    participant EE as ExecutionEngine
    participant Binance as Binance API
    participant OrderBook as Binance Order Book
    participant Contract as ArbitrageContract

    EE->>Binance: place_order(symbol, side, quantity, price)
    activate Binance

    Binance->>OrderBook: add_order_to_book()
    activate OrderBook
    OrderBook-->>Binance: order_added
    deactivate OrderBook

    Binance-->>EE: order_id
    deactivate Binance

    EE->>Binance: check_order_status(order_id)
    activate Binance
    Binance-->>EE: order_status
    deactivate Binance

    alt order_status == FILLED
        EE->>Binance: get_fill_details(order_id)
        activate Binance
        Binance-->>EE: fill_details{quantity, price, fees}
        deactivate Binance

        EE->>Contract: transfer_tokens_to_contract()
        activate Contract
        Contract-->>EE: tokens_received
        deactivate Contract

        EE->>EE: proceed_to_dex_swap()
    else order_status == PARTIALLY_FILLED
        EE->>EE: wait_for_completion()
        Note right of EE: ÏµúÎåÄ 30Ï¥à ÎåÄÍ∏∞
    else order_status == CANCELLED
        EE->>EE: cancel_arbitrage()
        Note right of EE: ÏïÑÎπÑÌä∏Î¶¨ÏßÄ Ï∑®ÏÜå
    end
```

---

## üí≥ Wallet Î™®Îìú ÏïÑÎπÑÌä∏Î¶¨ÏßÄ Ïã§Ìñâ ÌîåÎ°úÏö∞

### üîü ÏßÄÍ∞ë ÏûêÍ∏àÏùÑ Ïù¥Ïö©Ìïú ÏïÑÎπÑÌä∏Î¶¨ÏßÄ

```mermaid
sequenceDiagram
    participant EE as ExecutionEngine
    participant Wallet as Bot Wallet
    participant CEX as CEX API
    participant DEX as DEX Router
    participant BC as Blockchain

    EE->>Wallet: check_balance(required_amount)
    activate Wallet
    Wallet-->>EE: balance_confirmed
    deactivate Wallet

    EE->>CEX: place_buy_order(symbol, quantity, price)
    activate CEX
    CEX-->>EE: order_placed
    deactivate CEX

    EE->>CEX: wait_for_order_fill()
    activate CEX
    CEX-->>EE: order_filled
    deactivate CEX

    EE->>DEX: approve_tokens(router_address, amount)
    activate DEX
    DEX->>BC: approve_transaction
    activate BC
    BC-->>DEX: approval_confirmed
    deactivate BC
    DEX-->>EE: approval_successful
    deactivate DEX

    EE->>DEX: swap_tokens(token_in, token_out, amount_in, min_amount_out)
    activate DEX
    DEX->>BC: swap_transaction
    activate BC
    BC-->>DEX: swap_confirmed
    deactivate BC
    DEX-->>EE: swap_successful
    deactivate DEX

    EE->>EE: calculate_actual_profit()
    EE->>EE: update_performance_stats()
```

---

## ‚ö° Í≤ΩÏüÅ Î∂ÑÏÑù Î∞è Í∞ÄÏä§ ÏµúÏ†ÅÌôî ÌîåÎ°úÏö∞

### 1Ô∏è‚É£1Ô∏è‚É£ Ïã§ÏãúÍ∞Ñ Í≤ΩÏüÅ Î∂ÑÏÑù

```mermaid
sequenceDiagram
    participant CA as CompetitionAnalyzer
    participant MW as MempoolWatcher
    participant GA as GasAnalyzer
    participant GO as GasOptimizer
    participant EE as ExecutionEngine

    MW->>MW: watch_pending_transactions()
    activate MW

    loop Í∞Å ÏÉà Ìä∏ÎûúÏû≠ÏÖò
        MW->>MW: is_arbitrage_tx(tx)
        
        alt ÏïÑÎπÑÌä∏Î¶¨ÏßÄ Ìä∏ÎûúÏû≠ÏÖò Í∞êÏßÄ
            MW->>GA: analyze_gas_price(tx)
            activate GA
            GA-->>MW: gas_analysis
            deactivate GA

            MW->>CA: analyze_competition(tx)
            activate CA
            CA-->>MW: competition_level
            deactivate CA

            MW->>GO: adjust_gas_strategy(analysis)
            activate GO
            GO->>GO: calculate_optimal_gas()
            GO-->>MW: optimal_gas_price
            deactivate GO

            MW->>EE: update_gas_strategy(optimal_gas)
            activate EE
            EE->>EE: apply_gas_adjustment()
            deactivate EE
        end
    end

    deactivate MW
```

### 1Ô∏è‚É£2Ô∏è‚É£ ÎèôÏ†Å Í∞ÄÏä§ Í∞ÄÍ≤© Ï°∞Ï†ï

```mermaid
sequenceDiagram
    participant GO as GasOptimizer
    participant BC as Blockchain
    participant TA as TrendAnalyzer
    participant CA as CompetitionAnalyzer
    participant EE as ExecutionEngine

    GO->>BC: get_current_gas_price()
    activate BC
    BC-->>GO: (base_fee, priority_fee)
    deactivate BC

    GO->>TA: analyze_gas_trends()
    activate TA
    TA->>BC: get_historical_gas_prices()
    activate BC
    BC-->>TA: historical_data
    deactivate BC
    TA-->>GO: trend_analysis
    deactivate TA

    GO->>CA: get_competition_level()
    activate CA
    CA-->>GO: competition_score
    deactivate CA

    GO->>GO: calculate_aggressiveness(profit, competition)
    Note right of GO: aggressiveness = profit_ratio √ó 0.6 + competition √ó 0.4

    GO->>GO: adjust_priority_fee(aggressiveness)
    Note right of GO: priority_fee += (1 + aggressiveness) √ó 2 gwei

    GO->>GO: calculate_max_fee()
    Note right of GO: max_fee = base_fee + priority_fee √ó 2

    GO->>EE: apply_gas_strategy(max_fee, priority_fee)
    activate EE
    EE->>EE: update_transaction_gas()
    deactivate EE
```

---

## üö® ÏóêÎü¨ Ï≤òÎ¶¨ Î∞è Î≥µÍµ¨ ÌîåÎ°úÏö∞

### 1Ô∏è‚É£3Ô∏è‚É£ ÏïÑÎπÑÌä∏Î¶¨ÏßÄ Ïã§Ìñâ Ïã§Ìå® Ï≤òÎ¶¨

```mermaid
sequenceDiagram
    participant EE as ExecutionEngine
    participant BC as Blockchain
    participant EH as ErrorHandler
    participant RM as RetryManager
    participant FS as FallbackStrategy

    EE->>EE: execute_arbitrage(opportunity)
    activate EE

    EE->>BC: submit_transaction(tx)
    activate BC
    BC-->>EE: transaction_result
    deactivate BC

    alt Ìä∏ÎûúÏû≠ÏÖò Ïã§Ìå®
        EE->>EH: handle_execution_error(error)
        activate EH

        EH->>EH: classify_error(error)
        Note right of EH: Í∞ÄÏä§ Î∂ÄÏ°±, Ïä¨Î¶¨ÌîºÏßÄ Ï¥àÍ≥º,<br/>Í≤ΩÏüÅÏûê ÏÑ†Ï†ê Îì±

        alt Í∞ÄÏä§ Î∂ÄÏ°± ÏóêÎü¨
            EH->>RM: retry_with_higher_gas()
            activate RM
            RM->>EE: retry_with_adjusted_gas()
            deactivate RM
        else Ïä¨Î¶¨ÌîºÏßÄ Ï¥àÍ≥º ÏóêÎü¨
            EH->>FS: use_alternative_dex()
            activate FS
            FS->>EE: retry_with_different_dex()
            deactivate FS
        else Í≤ΩÏüÅÏûê ÏÑ†Ï†ê ÏóêÎü¨
            EH->>EE: skip_opportunity()
            Note right of EE: Îã§Ïùå Í∏∞ÌöåÎ°ú ÎÑòÏñ¥Í∞ê
        else Í∏∞ÌÉÄ ÏóêÎü¨
            EH->>EE: log_error_and_skip()
        end

        deactivate EH
    else Ìä∏ÎûúÏû≠ÏÖò ÏÑ±Í≥µ
        EE->>EE: update_success_stats()
    end

    deactivate EE
```

### 1Ô∏è‚É£4Ô∏è‚É£ Í±∞ÎûòÏÜå API Ïã§Ìå® Ï≤òÎ¶¨

```mermaid
sequenceDiagram
    participant EE as ExecutionEngine
    participant Binance as Binance API
    participant Coinbase as Coinbase API
    participant EH as ErrorHandler

    EE->>Binance: place_order()
    activate Binance
    Binance-->>EE: error_response
    deactivate Binance

    EE->>EH: handle_exchange_error(error)
    activate EH

    EH->>EH: classify_exchange_error(error)
    Note right of EH: API ÌÇ§ Ïò§Î•ò, Rate Limit,<br/>ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò Îì±

    alt API ÌÇ§ Ïò§Î•ò
        EH->>EE: use_fallback_exchange()
        EE->>Coinbase: place_order()
        activate Coinbase
        Coinbase-->>EE: order_placed
        deactivate Coinbase
    else Rate Limit Ïò§Î•ò
        EH->>EE: wait_and_retry()
        Note right of EE: 1Ï¥à ÎåÄÍ∏∞ ÌõÑ Ïû¨ÏãúÎèÑ
    else ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò
        EH->>EE: retry_with_backoff()
        Note right of EE: ÏßÄÏàò Î∞±Ïò§ÌîÑ Ïû¨ÏãúÎèÑ
    else Í∏∞ÌÉÄ Ïò§Î•ò
        EH->>EE: skip_opportunity()
        Note right of EE: Ìï¥Îãπ Í∏∞Ìöå Í±¥ÎÑàÎõ∞Í∏∞
    end

    deactivate EH
```

---

## üìä ÏÑ±Îä• Î™®ÎãàÌÑ∞ÎßÅ ÌîåÎ°úÏö∞

### 1Ô∏è‚É£5Ô∏è‚É£ Ïã§ÏãúÍ∞Ñ ÏÑ±Îä• Ï∂îÏ†Å

```mermaid
sequenceDiagram
    participant MAM as MicroArbitrageManager
    participant MC as MetricsCollector
    participant SC as StatsCalculator
    participant Dashboard as Dashboard
    participant AM as AlertManager

    MAM->>MC: collect_execution_metrics()
    activate MC

    MC->>MC: track_opportunities_detected()
    MC->>MC: track_arbitrages_executed()
    MC->>MC: track_profits_realized()
    MC->>MC: track_execution_times()

    MC-->>MAM: raw_metrics
    deactivate MC

    MAM->>SC: calculate_performance_stats(raw_metrics)
    activate SC

    SC->>SC: calculate_success_rate()
    SC->>SC: calculate_avg_profit()
    SC->>SC: calculate_uptime()
    SC->>SC: calculate_efficiency()

    SC-->>MAM: performance_stats
    deactivate SC

    MAM->>Dashboard: update_dashboard(performance_stats)
    activate Dashboard
    Dashboard-->>MAM: dashboard_updated
    deactivate Dashboard

    MAM->>AM: check_alert_conditions(performance_stats)
    activate AM

    alt ÏÑ±Í≥µÎ•† < 70%
        AM->>MAM: trigger_alert("Low success rate")
    else ÏàòÏùµ < ÏûÑÍ≥ÑÍ∞í
        AM->>MAM: trigger_alert("Low profitability")
    else ÏãúÏä§ÌÖú Ïò§Î•ò
        AM->>MAM: trigger_alert("System error")
    end

    deactivate AM
    deactivate MAM
```

### 1Ô∏è‚É£6Ô∏è‚É£ ÏÉÅÏÑ∏ ÏÑ±Îä• Î∂ÑÏÑù

```mermaid
sequenceDiagram
    participant PT as PerformanceTracker
    participant HA as HourlyAnalyzer
    participant EA as ExchangeAnalyzer
    participant SA as SymbolAnalyzer
    participant PA as ProfitabilityAnalyzer

    PT->>HA: analyze_hourly_performance()
    activate HA
    HA->>HA: group_by_hour()
    HA->>HA: calculate_hourly_stats()
    HA-->>PT: hourly_analysis
    deactivate HA

    PT->>EA: analyze_exchange_performance()
    activate EA
    EA->>EA: group_by_exchange()
    EA->>EA: calculate_exchange_stats()
    EA-->>PT: exchange_analysis
    deactivate EA

    PT->>SA: analyze_symbol_performance()
    activate SA
    SA->>SA: group_by_symbol()
    SA->>SA: calculate_symbol_stats()
    SA-->>PT: symbol_analysis
    deactivate SA

    PT->>PA: analyze_profitability_trends()
    activate PA
    PA->>PA: calculate_profit_margins()
    PA->>PA: identify_profitable_patterns()
    PA-->>PT: profitability_analysis
    deactivate PA

    PT->>PT: generate_performance_report()
    PT-->>PT: return_detailed_analysis()
```

---

## üéØ Í≤∞Î°†

Ïù¥ Î¨∏ÏÑúÎäî DeFi ÎßàÏù¥ÌÅ¨Î°úÏïÑÎπÑÌä∏Î¶¨ÏßÄ Ï†ÑÎûµÏùò Î™®Îì† Ï£ºÏöî ÏãúÎÇòÎ¶¨Ïò§Î•º ÏãúÌÄÄÏä§ Îã§Ïù¥Ïñ¥Í∑∏Îû®ÏúºÎ°ú ÏÉÅÏÑ∏Ìûà ÏÑ§Î™ÖÌï©ÎãàÎã§. Í∞Å Îã§Ïù¥Ïñ¥Í∑∏Îû®ÏùÄ:

1. **Ïã§Ï†ú Ïª¥Ìè¨ÎÑåÌä∏ Í∞Ñ ÏÉÅÌò∏ÏûëÏö©**ÏùÑ Ï†ïÌôïÌûà Î∞òÏòÅ
2. **Ïô∏Î∂Ä ÏÑúÎπÑÏä§ÏôÄÏùò ÌÜµÏã†**ÏùÑ Ìè¨Ìï®
3. **ÏóêÎü¨ Ï≤òÎ¶¨ Î∞è Î≥µÍµ¨ Î°úÏßÅ**ÏùÑ Î™ÖÏãú
4. **ÏÑ±Îä• ÏµúÏ†ÅÌôî Ï†ÑÎûµ**ÏùÑ ÏãúÍ∞ÅÌôî

Ïù¥Î•º ÌÜµÌï¥ Í∞úÎ∞úÏûêÎäî ÎßàÏù¥ÌÅ¨Î°úÏïÑÎπÑÌä∏Î¶¨ÏßÄ ÏãúÏä§ÌÖúÏùò Ï†ÑÏ≤¥Ï†ÅÏù∏ ÌùêÎ¶ÑÏùÑ Ïù¥Ìï¥ÌïòÍ≥†, Í∞Å Îã®Í≥ÑÏóêÏÑú Î∞úÏÉùÌï† Ïàò ÏûàÎäî Î¨∏Ï†úÏ†êÏùÑ ÌååÏïÖÌï† Ïàò ÏûàÏäµÎãàÎã§.

---

**ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏**: 2025-01-06  
**Î¨∏ÏÑú Î≤ÑÏ†Ñ**: v2.0  
**Íµ¨ÌòÑ ÏôÑÏÑ±ÎèÑ**: 95% (Production Ready)